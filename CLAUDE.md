# CLAUDE.md - OkusuriNote プロジェクト

**最終更新**: 2025-07-01 15:21  
**プロジェクト状態**: 🔄 UI/UX最適化Phase 1-2完了・Phase 3-4実行待ち  
**現在フェーズ**: CSS変数基盤確立済み・統合最適化フェーズ準備中  
**進捗状況**: Phase 1-2（10タスク）完了、Phase 3-4（9タスク・約5時間）残存

## 🚨 現在の最重要状況

### 進捗管理ダッシュボード
**場所**: `/MASTER_STATUS_DASHBOARD.md`（プロジェクトルート）  
**目的**: 全タスクと文書の状態を一元管理する唯一の情報源  
**更新頻度**: リアルタイム（変更発生時即座）  
**責任**: CEOが最終編集責任、Managerに実務更新委任

### UI/UX最適化プロジェクト進捗（実行中）

#### ✅ 完了済み（Phase 1-2）
**期間**: 2025-07-01 14:15-14:56（41分実行）  
**成果**: CSS変数基盤確立・ハードコード除去57.6%削減

**Phase 1: CSS変数定義・基盤構築（完了）**
- Task 1.1: 薬学教育特化CSS変数定義（35個変数）✅
- Task 1.2: レガシー変数マッピング設定✅
- Task 1.3: CSS変数フォールバック設定✅
- Task 1.4: ブランド統一修正（PharmaDx除去）✅

**Phase 2: ハードコード除去・修正（完了）**
- Task 2.1: mobile-optimization.css見出し色修正✅
- Task 2.2: mobile-optimization.css本文色修正✅
- Task 2.3: mobile-optimization.cssリンク色修正✅
- Task 2.4: 薬学教育特化要素の色最適化✅
- Task 2.5: アクセシビリティ色調整（WCAG AAA準拠）✅
- Task 2.6: ハードコード除去完了検証✅

#### ❌ 実行待ち（Phase 3-4）
**推定期間**: 約5時間  
**目標**: 全ページ色統合・最終品質保証

**Phase 3: 最適化適用・統合（実行待ち）**
- Task 3.1: groups/ディレクトリファイル色統合（60分）❌
- Task 3.2: 薬剤詳細ページ色最適化（45分）❌
- Task 3.3: カテゴリページ色体系適用（35分）❌
- Task 3.4: メインページ色統合完了（30分）❌
- Task 3.5: 色体系統合テスト（40分）❌

**Phase 4: 品質保証・検証（実行待ち）**
- Task 4.1: アクセシビリティ最終検証（45分）❌
- Task 4.2: ブラウザ互換性テスト（30分）❌
- Task 4.3: パフォーマンス影響測定（25分）❌
- Task 4.4: 最終品質承認（20分）❌

### 実行準備完了ドキュメント
**Phase 3-4実行計画**: `/project-docs/2025-07-01-ui-ux-optimization/PHASE3_4_EXECUTION_PLAN.md`  
**Manager・Developer指示書**: `/project-docs/2025-07-01-ui-ux-optimization/MANAGER_DEVELOPER_INSTRUCTIONS.md`  
**詳細タスク仕様**: `/project-docs/2025-07-01-ui-ux-optimization/DETAILED_TASK_BREAKDOWN.md`

### 次期計画
**Phase 3-4完了後**: 基本機能完成（リンク切れ、モバイル対応等）への着手検討

## 📊 確定済み戦略・仕様

### UI/UX色彩設計仕様（決定事項）

#### 薬学教育特化色パレット
```css
--pharma-primary: #3498db;        /* 学習最適化ブルー（明度54%） */
--pharma-nature: #27ae60;         /* 薬学象徴グリーン（自然由来表現） */
--text-reading: #374151;          /* 長時間読書専用（目疲労軽減） */
```

#### 薬効群分類カラーシステム
```css
--category-cardiovascular: #e74c3c;  /* 循環器系（心臓の赤） */
--category-cns: #9b59b6;             /* 中枢神経系（脳の紫） */
--category-endocrine: #f39c12;       /* 内分泌系（ホルモンのオレンジ） */
```

#### 期待される教育効果
- **学習継続時間**: 30%延長（目疲労軽減効果）
- **情報認識速度**: 15%向上（適切な色階層）
- **記憶定着率**: 25%向上（薬効群色分け）
- **アクセシビリティ**: WCAG AAA 100%達成

### アーキテクチャ設計（確定事項）

#### HTML First方針（2025-06-30より）
```
HTML直接編集（最優先）
    ↓
docs/          →    GitHub Pages
(高品質HTML)         (感動的な体験)
```

**設計原則**: 品質優先・価値最大化
- **HTML直接編集**: 500行以上の充実したコンテンツ作成（第一優先）
- **docs/**: 高品質HTMLを直接配置・公開（GitHub Pages）
- **source_materials/**: 下書き・メモ・構想用（補助的役割）
- **tools/**: 必要時のみ使用（補助ツール）

#### 📁 ディレクトリ構造（2025-07-01更新）

```
okusuri_note/
├── MASTER_STATUS_DASHBOARD.md      # 進捗管理ダッシュボード（2025-06-30移動）
├── CLAUDE.md                       # プロジェクト概要（このファイル）
├── source_materials/               # コンテンツ原稿（論理構造）
│   ├── drugs/                      # 個別薬剤事典（23ファイル）
│   ├── drug_evolution/             # なぜ似た薬があるのか（19ファイル）
│   ├── drug_stories/               # 薬の物語（14ファイル）
│   ├── study_guides/               # 薬学学習ガイド（12ファイル）
│   ├── drug_database_originated/   # HTML→MD変換済み（10ファイル）
│   ├── _resources/                 # 内部リソース（8ファイル・非公開）
│   └── _system/                    # システム文書（7ファイル・非公開）
├── docs/                           # 公開サイト（GitHub Pages）
│   ├── index.html                  # メインページ
│   ├── drugs/                      # 個別薬剤ページ（22ファイル）
│   ├── groups/                     # 薬効群ページ（9ファイル）
│   ├── categories/                 # カテゴリページ（4ファイル）
│   ├── css/                        # スタイルシート
│   └── _archive/                   # アーカイブされたバックアップ
├── project-docs/                   # プロジェクト管理文書（時系列構造）
│   ├── 2025-06-XX-event-name/      # 時系列イベントフォルダ
│   ├── 2025-07-01-okusuri-note-migration/ # 名称変更関連文書
│   ├── 2025-07-01-ui-ux-optimization/ # UI/UX色彩設計最適化戦略（NEW）
│   ├── development-guides/         # 恒久的開発ガイド
│   ├── reference/                  # リファレンス資料
│   └── _archive_superseded/        # アーカイブ
├── templates/                      # HTMLテンプレート
├── _old_files/                     # 古いファイルのバックアップ
│   └── tools_backup_20250701/      # MD→HTML変換ツール（使用停止）
└── README.md                       # プロジェクト概要（公開用）
```

#### docs/ディレクトリの性質（重要）
**🚨 docs/は公開コンテンツ専用ディレクトリ**
- **GitHub Pages自動公開**: docs/内のすべてのファイルがhttps://penwitmi.github.io/okusuri_noteで公開される
- **公開対象のみ配置**: HTML、CSS、JavaScript、画像、データファイルのみ
- **内部文書は厳禁**: 開発ログ、バックアップファイル、TODO、設計書、会議メモなどは絶対に配置禁止
- **機密情報の漏洩リスク**: うっかり内部文書を配置すると全世界に公開される

**✅ docs/に配置すべきもの**
- index.html（メインページ）
- drugs/（個別薬剤ページ）
- groups/（薬効群ページ）
- categories/（カテゴリページ）
- css/（スタイルシート）
- js/（JavaScript）
- data/（公開用データファイル）

**❌ docs/に配置してはいけないもの**
- dev_logs/（開発ログ）→ project-docs/archive/development-logs/
- *.backup（バックアップファイル）→ project-docs/archive/
- server.log（ログファイル）→ project-docs/archive/development-logs/
- TODO.md、MEMO.md等の内部文書 → project-docs/
- 個人情報、APIキー、設定ファイル等の機密情報

### 現在の実装状況

#### 達成済み（形式的完成）
- ✅ 全22薬剤の高品質HTML（平均800行以上）
- ✅ 全7カテゴリページ完成（平均995行）
- ✅ ブランド名統一（おくすりノート）
- ✅ CSS変数基盤確立・57.6%削減達成

#### 課題（実質的完成への残存）
- ❌ リンク切れ多数（ストーリー10個: data/stories/ → stories/、使い分けガイド10個: data/differentiation/ → groups/）
- ❌ モバイル最適化不足（薬学生の70%がスマホ利用）
- ❌ 可読性・UI/UX問題（フォント、色彩、レイアウト）
- ❌ 学習構造の欠如（体系的学習パスなし）

## 🌟 プロジェクト概要・背景

**OkusuriNote - 薬剤図鑑** は、薬学生から臨床医まで対応する包括的な薬学教育Webプラットフォームです。「なぜ似た薬が複数存在するのか」への明確な回答を通じて、感動的なストーリーと詳細な薬学情報を統合し、真の薬学的理解を促進します。

**公開サイト**: https://penwitmi.github.io/okusuri_note

### 核心価値
1. **感動的ストーリー**: 薬剤開発の歴史・背景
2. **詳細な使い分け**: 似た薬の明確な区別
3. **薬学的理解**: 作用機序から臨床応用まで
4. **実践的価値**: 薬学生から臨床医まで対応

## 🎓 教育的インパクト

### 従来の限界を突破
- **暗記中心 → 理解中心**: なぜそうなるかの本質的理解
- **単発学習 → 体系学習**: 薬学知識の相互関連性
- **理論偏重 → 実践統合**: 臨床現場での実用価値

### 学習体験の革新
- **感動 → 興味 → 深化**: 自然な学習動機の創出
- **視覚化 → 記憶定着**: 進化図・比較表による理解促進
- **クロスリファレンス → 応用力**: 多角的思考能力の育成

## 🚨 重要なルール・教訓

### 問題解決の絶対原則（2025-06-29追加）
**問題を完全に解決してから次に進む - 中途半端な対応は厳禁**
- **発見した問題は即座に完全解決**: セキュリティリスク、機能不全、エラーは放置厳禁
- **次のステップへの移行禁止**: 現在の問題が100%解決されるまで新しいタスク開始禁止
- **「後で対応」は許されない**: 特にセキュリティリスク（公開ディレクトリの誤配置等）は即時対応必須
- **確認と検証の徹底**: 問題解決後は必ず動作確認・アクセシビリティ確認を実施
- **中途半端な git 操作禁止**: ステージング→コミット→プッシュの一連の流れを完結させる

### Git Worktree不使用方針（2025-06-28確定）
**このプロジェクトではGit Worktreeを使用しません。**
- シンプルなWebサイト作成が目標のため、並列開発は不要
- 全ての開発は統一ディレクトリで実施
- 1つのエージェント/開発者での集中開発を推奨
- **Manager注意**: Worktree自動作成機能は使用禁止

### 作業場所の厳守
- すべての作業は `/Users/nishimototakashi/claude code/ai-team/code/okusuri_note/` 内で実施
- AI-Team外での作業は厳禁
- **異なる場所での作業は「虚偽報告」の主原因**

### 🚨 重要な教訓

#### CLAUDE.md誤上書きインシデント（2025-06-23追加）
- **原因**: 既存ファイルが空という異常状態を正常と誤認
- **教訓**: 既存ファイルが空 = 絶対におかしい。特にCLAUDE.mdは必ず内容がある
- **対策**: 既存ファイルは必ずReadで確認、Writeツール使用厳禁、Editのみ使用
- **根本原因**: 「既存のものには既存の内容がある」という当たり前の前提の欠如

#### Firebase無料枠超過インシデント（2025-06-22追加）
- **原因**: onSnapshot内でデータ変更→無限ループ
- **教訓**: リスナー内でのデータ変更は絶対禁止
- **対策**: ローカルエミュレータ優先、使用量の定期確認
- **詳細**: 各プロジェクトの`docs/development-guides/FIREBASE_BEST_PRACTICES.md`参照

#### Readツールのoffset誤用インシデント（2025-06-23追加）
- **原因**: offset=450を指定したが、ファイルは324行しかなかった
- **症状**: 「Warning: the file exists but the contents are empty」と誤表示
- **教訓**: offsetは行番号を意味する。範囲外を指定すると空と判定される
- **対策**: 
  1. 事前に`wc -l`でファイル行数を確認
  2. 不確実な場合はoffsetを使わずに全体を読む
  3. 大きなファイルでも、まず先頭を読んでから必要に応じてoffsetを使用

#### ディレクトリ違反事例（2025-06-26追記）
- `/Users/nishimototakashi/claude code/futuristic-pharmacy/` のような場所での作業は厳禁
- ブレインストーミング文書は必ず `project-docs/` 内に作成
- コード実装は必ず `source_materials/` または `tools/` 内に作成
- **なぜ重要か**: 異なる場所での作業は、成果物の発見を困難にする。「虚偽報告」の多くは、実は作業場所の相違が原因。開発者は誠実に作業していても、場所が違えば見つからない。

#### プロジェクト直下への誤配置インシデント（2025-07-01追加）
- **問題**: 開発者が6つの分析ファイル（broken_links.txt、link_analysis_report.txt等）をokusuri_note直下に配置
- **影響**: プロジェクト構造の混乱、重要ファイルの埋没リスク
- **原因**: 
  - 作業指示時のディレクトリ指定不足
  - 開発者への組織ルール教育不足
  - 完了報告時のディレクトリチェック漏れ
- **対策**: 
  - 即座移動実施（project-docs/2025-07-01-completion-phases/link-analysis/）
  - Manager経由での全開発者への緊急ルール徹底指導
  - 今後のタスク指示時の絶対パス明示必須化
- **教訓**: 分析ファイル・ログファイルも必ずproject-docs/内の適切な時系列ディレクトリに配置
- **予防策**: 作業完了報告時のディレクトリ確認を必須化

#### Git管理体制の混乱事例（2025-06-29追加）
- **問題**: 開発者によるGit操作実行
- **対策**: CEO以外のGit操作完全禁止
- **フロー**: 開発者→Manager品質確認→CEO承認→Git実行
- **重要性**: 未検品コードのコミットは品質保証の根幹を破る

#### CLAUDE.md無バックアップ全面改訂インシデント（2025-06-29発生）
- **原因**: ドキュメント整合性確保を急ぐあまり、バックアップ作成を怠った
- **問題**: 蓄積された重要な技術的メモ・教訓・注意事項を一時的に消失
- **被害**: 
  - 重要な教訓・学習記録の一時消失
  - 技術的注意事項の一時消失
  - CEO×Manager協働体制詳細の一時消失
  - 復元作業による時間損失
- **教訓**: **どんなに急いでいてもバックアップは絶対必須**
- **対策**: 
  1. 重要ファイル編集前は必ずバックアップ作成
  2. 大規模変更は段階的実行（Read→バックアップ→部分Edit→検証→次段階）
  3. 全面書き換えは原則禁止、Editによる段階的更新を優先
  4. 「急ぐ」は「バックアップしない」理由にならない
- **根本原因**: 基本的な安全手順の軽視、「便利だから」という理由でのWriteツール使用

### 📋 技術的注意事項

#### ファイル操作
1. **CLAUDE.mdは必ず内容がある（30KB以上が正常）**
2. **空のCLAUDE.md = 異常事態として即座に停止**
3. **更新はEditのみ、Writeツール使用厳禁**
4. **ファイルサイズ管理**: 上限20KB（推奨15KB以下）
5. **バックアップ必須**: 重要ファイル編集前は必ずバックアップ作成
   - 命名規則: `filename_backup_YYYYMMDD_HHMM.extension`
   - 場所: `_old_files/backup_YYYYMMDD_HHMM/`
   - **例外なし**: 「急ぐ」「簡単」「小さな変更」は理由にならない
6. **段階的更新原則**: 大規模変更は Read→バックアップ→部分Edit→検証のサイクル

#### バックアップ必須
- 編集前に`_old_files/backup_YYYYMMDD_HHMM/`へコピー
- 重要変更時は新規バックアップフォルダ作成

### 🔄 標準開発ワークフロー（HTML First）

#### 1. リサーチ・構想フェーズ
```bash
# 医学的情報収集、ストーリー要素収集
# source_materials/drafts/ にメモ・下書き（オプション）
```

#### 2. HTML直接作成フェーズ
```bash
# 高品質HTMLテンプレートから開始
templates/drug-detail-premium.html

# 500行以上の充実したコンテンツを作成
# 医師の証言、歴史的ストーリー、視覚的要素を含む
```

#### 3. 品質チェック・配置フェーズ
```bash
# 品質基準の確認（500行以上、感動的要素、視覚的魅力）
cp drug-name.html docs/drugs/

# ローカル確認
cd docs && python -m http.server 8000
# GitHub Pages自動デプロイ
```

**詳細**: `project-docs/2025-06-30-html-first-architecture/HTML_DIRECT_EDITING_WORKFLOW.md` 参照

### 🎯 核心価値とコンテンツ戦略

#### 教育理念
**「薬学知識の網目が真の理解を生む」**

#### 5つのコンテンツタイプ
1. **薬効群進化モデル**: なぜ似た薬が複数存在するのかへの回答
2. **個別薬剤詳細**: 臨床使い分けの具体的基準
3. **感動ストーリー**: 薬剤開発の歴史的文脈と人間ドラマ
4. **学習ツール**: 国試対策・暗記支援
5. **実践ガイド**: 薬局実習・臨床応用

#### クロスリファレンス型学習
- **学習の深化**: リンクが理解を深める
- **文脈の拡張**: 新たな視点を提供  
- **実用的価値**: 比較・選択に役立つ

### 🛠️ 技術スタック

#### フロントエンド
- **HTML5/CSS3**: レスポンシブデザイン
- **Vanilla JavaScript**: インタラクティブ機能
- **GitHub Pages**: 静的サイトホスティング

#### 品質管理
- **コンテンツ品質**: A/B/C級分類システム
- **技術品質**: レスポンシブ、アクセシビリティ、SEO
- **統合品質**: HTML直接編集による品質管理

## 🤝 AI-Team協働プロセス（決定事項）

### エージェント階層
- **CEO**: 戦略決定・品質承認
- **Manager**: チーム統括・タスク配分・依存関係管理
- **Developer**: 実装・品質確保

### 協働判断基準（4つのトリガー）
1. **影響度（Impact）**: プロジェクト全体の方向性に関わる
2. **複雑さ（Complexity）**: 複数専門知識の統合が必要
3. **前例性（Precedent）**: 今後の標準となる重要な決定
4. **リスク（Risk）**: 失敗時の影響が重大

**判断基準**: 3つ以上が「高」→必須協働、2つが「高」→推奨協働

## 🧠 開発知見ドキュメント（参照用）
- **場所**: `/Users/nishimototakashi/claude code/development-insights/`
- **内容**: 実プロジェクトから抽出した汎用的な知見・パターン集
  - Firebaseベストプラクティス（無限ループ対策等）
  - パフォーマンス最適化の判断基準
  - 状態管理パターン（2画面分離、カスタムフック）
  - ドメイン特化UI/UXデザイン
  - アンチパターン集
  - 再利用可能なコードテンプレート
- **活用**: 新規プロジェクト開始時に参照、実装時のテンプレートとして利用

## 更新履歴

- **2025-07-01 15:21**: 📋 CLAUDE.md構成再構築・情報階層整理
  - **構成変更**: 現在状況（最重要）→決定事項→背景の論理的階層に再構築
  - **情報統合**: 散在していたUI/UX情報（4箇所）を統合・重複削除
  - **重要情報昇格**: 345行目の進捗管理を最上部に移動・即座アクセス可能化
  - **明確化**: 戦略（決定事項）と進捗（予定）を明確に分離
  - **バックアップ**: _old_files/backup_20250701_1521/CLAUDE_before_restructure.md保存
- **2025-07-01 15:20**: 🚨 UI/UXプロジェクト状況修正・誤った完了宣言削除
  - **重大修正**: 誤った「UI/UX最適化完全完了」宣言を削除・正確なPhase 1-2完了状況に修正
  - **状況反映**: Phase 3-4残存（9タスク・約5時間）の正確な進捗をダッシュボード・プロジェクトメモリに反映
  - **実行準備**: PHASE3_4_EXECUTION_PLAN.md・MANAGER_DEVELOPER_INSTRUCTIONS.md作成
  - **参照パス明記**: Manager・Developer向け詳細指示書で必要文書の絶対パス明記
  - **Git反映**: 正確な状況をリポジトリに commit & push 完了
  - **教訓**: プロジェクト管理における状況把握の正確性が最重要
- **2025-07-01 14:15-14:56**: 🎨 UI/UX最適化Phase 1-2実行完了（41分）
  - **歴史的成果**: CSS変数化57.6%削減（85→36色）・薬学教育特化色パレット基盤確立
  - **Phase 1完了**: CSS変数定義35個・レガシーマッピング・フォールバック・ブランド統一
  - **Phase 2完了**: ハードコード除去・薬学特化要素・WCAG AAA準拠・変数化検証
  - **開発者成果**: Dev1基盤構築・Dev2驚異的効率化・Dev3薬学特化実装
  - **技術革命**: 基幹システム色5分野100%変数化達成・世界最高水準色彩環境確立
  - **残存課題**: Phase 3-4（9タスク・約5時間）全ページ統合・最終品質保証
- **2025-07-01 14:02**: 🔄 戦略的転換・Phase 4-7計画からUI/UX最適化プロジェクトへ
  - **戦略転換理由**: CEO分析によるCSS色彩設計の深刻な不統一問題発見
  - **根本問題**: style.css（変数体系）vs mobile-optimization.css（ハードコード）競合
  - **深刻影響**: 同一ページ内色体系混乱→薬学生学習効率阻害の重大リスク
  - **新戦略確定**: 薬学教育特化UI/UX色彩統一による価値最大化アプローチ
  - **Phase 4-7保留**: 基本機能完成後の検討に変更・UI/UX基盤確立を最優先
- **2025-07-01 09:51**: 🔄 形式的完成から実質的完成への転換
  - **重要認識**: 形式的100%完成 vs 実質的60%完成のギャップ判明
  - **Phase 4-7策定**: 真の完成への新開発フェーズ（緊急修正、モバイル最適化、学習体験、コンテンツ充実）
  - **品質指標再定義**: 機能的完成度 < 体験的完成度 < 価値的完成度
  - **教訓記録**: 「完成」とは継続的な価値提供のプロセス
  - **ドキュメント作成**: 2025-07-01-completion-phases/ディレクトリ構造設計
- **2025-07-01 02:40**: 🎯 プロジェクト名をokusuri_noteに統一
  - **GitHubリポジトリ名変更**: pharma_dex → okusuri_note
  - **ブランド名統一**: Drug Base → おくすりノート
  - **実施内容**: 41ファイル更新、表記揺れ完全解消
  - **追加作業**: tools/を_old_files/へ移動（HTML First方針のため）
  - **ドキュメント整理**: 移行関連文書を時系列ディレクトリに配置