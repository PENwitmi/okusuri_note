# CSS背景色改革の正しい作業フロー

作成日時: 2025-07-26  
作成理由: carvedilol.html修正時の作業順序ミスからの教訓

## 今回の失敗

### 間違った作業順序
1. ❌ 色のネストを先に探そうとした
2. ❌ `<p class="alert">`を見つけて色付きだと勘違い
3. ❌ 構造を確認せずに要素を外に出した
4. ❌ 結果として論理構造を破壊

### 失敗の原因
- **外側がすでにsimple-box（白背景）だったことを確認していなかった**
- 白背景の中の要素は、色のネストではない
- 構造的な変更を先にしないと、色のネストかどうかの判断ができない

## 正しい作業フロー

### 📋 ステップ1: components.cssの方針を理解
1. **components.cssに記載されている使用例（17行目）**
   - **key-point-box**（橙）→ 「処方のコツ」
   - **info-box**（青）→ 「エビデンス」
   - **simple-box**（白）→ 「補足説明」

2. **重要な方針（29行目）**
   - **「用途名にとらわれず、デザインや構造の類似性で選択してください」**
   - 厳密な用途制限はない
   - 視覚的な効果とバランスを重視

3. **色付きボックスの使い分けの基準**
   - 大きな領域の構造的コンテンツ → simple-box（白背景）
   - 重要度や性質に応じて色付きボックスを選択
   - 全体的に「色まみれ」にならないようバランスを考慮

### 📋 ステップ2: 色のネスト確認（構造変更後）
1. **色のネストの定義を正しく理解**
   - ✅ 色付き背景の中に色付き背景 = 色のネスト（修正必要）
   - ✅ 白背景の中に色付き背景 = 正常な使い方（修正不要）

2. **実際の色のネストのみを修正**
   - info-box（青）の中にalert-box（黄）がある → ネスト
   - simple-box（白）の中にhighlight-box（緑）がある → 正常

### 📋 ステップ3: 最終確認
1. **論理構造が保たれているか**
   - 番号付きリストが分断されていないか
   - 階層構造が正しいか

2. **視覚的バランス**
   - 白背景が主体になっているか
   - 色付きボックスが適度に使われているか

## 重要な判断基準

### 色のネストではないケース
```html
<!-- ✅ 正常：白背景の中に色付き -->
<div class="simple-box">
    <h4>タイトル</h4>
    <p>説明文</p>
    <div class="highlight-box">
        <p>重要ポイント</p>
    </div>
</div>
```

### 色のネストのケース
```html
<!-- ❌ 修正必要：色の中に色 -->
<div class="info-box">
    <h4>タイトル</h4>
    <p>説明文</p>
    <div class="alert-box">
        <p>警告</p>
    </div>
</div>
```

## 実際の作業手順

### 1. 現状把握（必須）
```bash
# すべての色付きボックスの使用状況を確認
grep -o 'class="[^"]*-box"' filename.html | sort | uniq -c | sort -nr
```

### 2. 各色付きボックスの内容確認
```bash
# 例：alert-boxの使用箇所を確認
grep -B 2 -A 5 'alert-box' filename.html
```

### 3. 判断と修正
- 本来の用途と異なる使用 → simple-boxまたはplain-boxに変更
- 色のネストがある場合 → 構造変更後に再確認

## 教訓

1. **CSSファイルの説明を必ず最初に読む**
   - components.cssの冒頭にある使用方針を確認
   - 勝手に用途を定義しない
   - 「用途名にとらわれず」という重要な方針を理解

2. **視覚的なバランスを最優先**
   - 厳密な用途制限よりも見た目の「色まみれ」感の解消
   - 白背景（simple-box）を主体にする
   - 色付きボックスは適度に使用

3. **構造の変更を最優先**
   - 色のネストかどうかは、外側の要素次第
   - 構造を変えてから色のネストを判断する

4. **要素を移動する前に必ず確認**
   - 外側は何色か？
   - 論理構造を壊さないか？

5. **「色のネスト」の定義を正しく理解**
   - 白背景は「色なし」として扱う
   - 白の中の色は正常な階層構造