# Phase 2 開発ワークフロー - 新構造対応

**作成日**: 2025-06-29  
**対象**: Phase 2大規模再構築後の開発フロー  
**ステータス**: 運用開始

## 📋 新構造の概要

### ディレクトリ構造の論理化
```
pharma_dex/
├── content/          # コンテンツ原稿（機能別論理構造）
├── tools/            # 開発ツール統合
├── docs/             # 公開サイト（GitHub Pages）
└── project-docs/     # プロジェクト管理
```

### 主要な変更点
1. **01-06数字構造** → **機能別論理構造** への移行
2. **分散ツール** → **tools/統合** への集約
3. **website/** → **docs/** への移行（GitHub Pages対応）

## 🔄 標準開発フロー

### 1. コンテンツ編集フェーズ
```bash
# 作業場所の確認
cd /Users/nishimototakashi/claude\ code/ai-team/code/pharma_dex

# コンテンツ編集
├── content/stories/              # ストーリー追加・修正
├── content/drug_database/        # 薬効群モデル追加・修正
├── content/study_tools/          # 学習ツール追加・修正
└── content/differentiation/      # 使い分けガイド追加・修正
```

### 2. ビルド実行フェーズ
```bash
# ツールディレクトリに移動
cd tools

# 統合ビルド実行
./build.sh

# 個別変換のみ（必要に応じて）
./run_conversion.sh
```

### 3. 確認・デプロイフェーズ
```bash
# 生成結果確認
cd ../docs
python -m http.server 8000
# ブラウザ: http://localhost:8000

# GitHub Pages確認
# https://penwitmi.github.io/pharm_dex
```

## 🛠️ ツール詳細

### tools/build.sh（統合ビルドスクリプト）
**機能**: 
- コンテンツ統計生成
- バックアップ作成
- 変換実行
- 統合検証
- 完了レポート

**使用場面**: 通常の開発サイクル

### tools/run_conversion.sh（変換専用）
**機能**:
- コンテンツ変換のみ
- Node.js依存関係管理
- 詳細ログ出力

**使用場面**: デバッグ、変換ロジック調整時

### tools/convert_pharmadx.js（変換エンジン）
**機能**:
- Markdown → HTML変換
- 品質評価・分類
- クロスリファレンス生成
- インタラクティブ要素追加

**編集対象**: 変換ロジック改修時

### tools/config.json（設定管理）
**機能**:
- 薬剤・薬効群定義
- パスマッピング
- 品質基準設定
- SEO設定

**編集対象**: 新薬剤追加、設定変更時

## 📊 品質管理フロー

### 変換前チェック
1. **コンテンツ整合性**: Markdownファイルの構文確認
2. **参照整合性**: 内部リンク・ファイルパス確認
3. **画像・リソース**: 外部リソースの存在確認

### 変換後検証
1. **HTML生成**: 予期したファイル数・構造の生成確認
2. **リンク整合性**: 内部リンクの動作確認
3. **レスポンシブ**: モバイル表示の確認

### デプロイ前最終確認
1. **機能テスト**: 検索・ナビゲーション動作確認
2. **SEO**: メタデータ・構造化マークアップ確認
3. **アクセシビリティ**: フォーカス管理・スクリーンリーダー対応

## 🚨 トラブルシューティング

### よくある問題と解決法

#### 1. パス参照エラー
**症状**: ファイルが見つからないエラー
**解決**: 
- 新構造のパス確認: `content/`, `docs/`, `tools/`
- 相対パス修正: `../content/`, `../docs/`

#### 2. Node.js依存関係エラー
**症状**: npm パッケージエラー
**解決**:
```bash
cd tools
rm -rf node_modules package-lock.json
npm install
```

#### 3. GitHub Pages反映遅延
**症状**: 変更がサイトに反映されない
**解決**:
- GitHub Actions確認
- docs/ディレクトリ内容確認
- ブラウザキャッシュクリア

#### 4. 変換失敗
**症状**: build.sh実行時エラー
**解決**:
- tools/ディレクトリから実行確認
- ファイル権限確認: `chmod +x *.sh`
- ログ詳細確認: エラーメッセージ分析

## 📈 パフォーマンス最適化

### ビルド時間短縮
1. **増分ビルド**: 変更ファイルのみ処理
2. **並列処理**: 薬効群別の並列変換
3. **キャッシュ活用**: 変更なしファイルのスキップ

### サイト表示速度向上
1. **画像最適化**: WebP変換、サイズ最適化
2. **CSS/JS最小化**: 不要コメント・空白削除
3. **CDN活用**: 外部リソースのCDN化

## 🎯 Phase 3への準備

### 自動化パイプライン構築
1. **GitHub Actions**: push時自動ビルド
2. **品質ゲート**: 自動テスト・検証
3. **デプロイ自動化**: ステージング → 本番環境

### スケーラビリティ対応
1. **コンテンツ管理**: 大量薬剤対応
2. **検索高速化**: Elasticsearch導入検討
3. **ユーザー機能**: パーソナライズ機能準備

---

**Phase 2大規模再構築により、PharmaDxは次の成長段階への基盤を確立しました。**