# コンテンツ分離アーキテクチャ設計書

**作成日**: 2025-06-29  
**バージョン**: 2.0（Phase 2再構築対応）  
**ステータス**: 運用中

## 🏗️ アーキテクチャ概要

PharmaDxは**コンテンツと公開の完全分離**を核心とする設計を採用しています。

### 設計原則：関心の分離 (Separation of Concerns)

```
content/          ←→          docs/
(コンテンツ原稿)    ｜変換｜    (公開サイト)
専門知識の蓄積      tools/     ユーザー体験
```

## 📁 ディレクトリ責務定義

### content/ - コンテンツ原稿レイヤー
**責務**: 薬学知識の蓄積・編集
```
content/
├── stories/           # 感動ストーリー原稿
├── drug_database/     # 薬効群詳細モデル
├── differentiation/   # 使い分けガイド
├── study_tools/       # 学習ツール
├── exhibition/        # 展示企画
└── resources/         # リソース・データ
```

**特徴**:
- **編集重視**: Markdown/HTML形式での効率的編集
- **内容重視**: デザインやレイアウトに関与しない
- **専門性**: 薬学的正確性と教育価値に特化
- **バージョン管理**: Git履歴による変更追跡

### docs/ - 公開サイトレイヤー
**責務**: ユーザー体験の提供
```
docs/
├── index.html         # メインエントリーポイント
├── generated/         # 変換済みコンテンツ
│   ├── drugs/         # 個別薬剤ページ
│   ├── groups/        # 薬効群ページ
│   ├── stories/       # ストーリーページ
│   ├── css/           # スタイルシート
│   ├── js/            # インタラクティブ機能
│   └── data/          # 構造化データ
└── css/               # メインスタイル
```

**特徴**:
- **ユーザー体験重視**: レスポンシブ、アクセシビリティ
- **公開最適化**: SEO、パフォーマンス最適化
- **GitHub Pages対応**: 直接デプロイ可能
- **自動生成**: 手動編集を最小限に

### tools/ - 変換処理レイヤー
**責務**: content/ → docs/ 変換
```
tools/
├── convert_pharmadx.js    # 変換エンジン
├── config.json           # 設定管理
├── run_conversion.sh     # 変換実行
└── build.sh              # 統合ビルド
```

**特徴**:
- **自動化**: コンテンツ変更の自動反映
- **品質管理**: A/B/C級分類と適切な変換戦略
- **拡張性**: 新しい変換ルールの追加容易
- **統合性**: 全体ビルドプロセスの管理

## 🔄 データフロー設計

### 標準開発サイクル
```
1. コンテンツ編集
   content/*.md を編集
   ↓
2. 変換実行
   cd tools && ./build.sh
   ↓
3. 公開確認
   docs/ でプレビュー・デプロイ
```

### 変換プロセス詳細
```
content/stories/01_penicillin.md
    ↓ [convert_pharmadx.js]
docs/generated/stories/01_penicillin.html
    ↓ [HTML最適化・SEO・クロスリファレンス]
完全なWebページ
```

## 🎯 関心分離の利点

### 1. 専門性の分離
- **コンテンツ**: 薬学的正確性に集中
- **公開サイト**: ユーザビリティに集中
- **変換**: 技術的最適化に集中

### 2. 保守性の向上
- **独立修正**: 各レイヤーの独立した修正可能
- **責任明確**: 問題発生時の責任範囲が明確
- **専門化**: 各レイヤーの専門知識を活用

### 3. スケーラビリティ
- **コンテンツ拡張**: 新薬剤・薬効群の容易な追加
- **機能拡張**: 新しいWebフィーチャーの独立実装
- **チーム拡張**: レイヤー別の専門チーム編成可能

### 4. 技術的柔軟性
- **コンテンツ形式**: Markdown以外への対応可能
- **出力形式**: Web以外（PDF、アプリ等）への展開可能
- **変換技術**: 新しい変換技術の導入容易

## 🔧 実装詳細

### コンテンツ形式標準化
```markdown
# 薬効群名

## 📍 5分サマリー
### 薬効群の本質
### 主要薬剤一覧
### 処方選択フローチャート

## 📊 臨床使い分けマトリックス
## 💊 実際の処方例
## 📊 処方実態解明
```

### 変換設定管理
```json
{
  "contentMapping": {
    "drugGroups": {
      "ARB": "content/drug_database/cardiovascular/ARB_evolution_model.md"
    }
  },
  "qualityStandards": {
    "A": { "score": 4.8, "action": "品質保持+視覚化強化" }
  }
}
```

### 公開最適化
```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{動的タイトル} - PharmaDx薬剤図鑑</title>
    <!-- SEO最適化メタデータ -->
    <!-- 構造化マークアップ -->
</head>
```

## 📊 品質保証体制

### コンテンツ品質
- **医学的正確性**: 薬学専門知識による検証
- **教育価値**: 学習効果の測定・改善
- **更新性**: 最新情報の定期的反映

### 技術品質
- **パフォーマンス**: ページ読み込み速度最適化
- **アクセシビリティ**: WCAG 2.1 AA準拠
- **SEO**: 検索エンジン最適化

### 統合品質
- **整合性**: content/ ↔ docs/ の一貫性
- **リンク整合性**: 内部リンクの自動検証
- **デプロイ品質**: GitHub Pages正常動作

## 🚀 将来拡張計画

### Phase 3: 高度機能
- **AI検索**: 自然言語による薬剤検索
- **パーソナライズ**: ユーザー別学習パス
- **インタラクティブ**: 薬剤シミュレーション

### 技術拡張
- **マルチ出力**: PWA、デスクトップアプリ
- **API化**: 外部システムとの連携
- **リアルタイム**: ライブ更新機能

---

**このアーキテクチャにより、PharmaDxは持続可能で拡張性の高い薬学教育プラットフォームを実現しています。**